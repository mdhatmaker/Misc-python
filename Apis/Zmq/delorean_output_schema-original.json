{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Delorean Output Schema",
    "type": "object",
    "properties": {
        "type": "object",
        "oneOf" : [
            {"$ref": "#/definitions/delorean_prediction"},
            {"$ref": "#/definitions/delorean_prediction_error"}
        ]
    },
    "definitions": {
        "delorean_prediction" : {
            "type": "object",
            "properties": {
                "PredictedReadyDate": {
                    "type": "string",
                    "description": "The predicted for when the loan will be ready to trade.",
                    "format": "date"
                },
                "PredictionLogRecords": {
                    "type": "array",
                    "description": "Array of prediction log records that were generated by the underlying models.",
                    "items": { "$ref": "#/definitions/prediction_log_record_schema"  }
                },
                "Metadata": {
                    "type": "object",
                    "description": "Key value pairs containing metadata about the delorean model and service."
                },
                "Messages": {
                    "type": "array",
                    "description": "Array of message objects.",
                    "items": { "$ref": "#/definitions/message"}
                }
            },
            "required": [
                "PredictedReadyDate",
                "PredictionLogRecords",
                "Metadata",
                "Messages"
            ]
        },
        "prediction_log_record_schema": {
            "type": "object",
            "properties": {
                "Key": {
                    "type": "string",
                    "description": "Key."
                },
                "ModelQualifiedName": {
                    "type": "string",
                    "description": "The qualified name of the model used to make the prediction."
                },
                "ModelVersion": {
                    "type": "string",
                    "description": "The version of the code of the model. Follows semantic versioning standard."
                },
                "ModelParametersVersion": {
                    "type": "string",
                    "description": "The version of the parameters of the model."
                },
                "PredictionQualifiedName": {
                    "type": "string",
                    "description": "Qualified name of the prediction. This ties the prediction log record to the model."
                },
                "EntityQualifiedName": {
                    "type": "string",
                    "description": "Qualified name of the entity on which the prediction is being made."
                },
                "EntityMatch": {
                    "type": "object",
                    "description": "Dictionary of values that can uniquely identify the entity on which the prediction is being made."
                },
                "DateTimeCreated":{
                    "type": "string",
                    "description": "The datetime when the prediction was made.",
                    "format": "date-time"
                },
                "Inputs": {
                    "type": "object",
                    "description": "Dictionary of input values that were given to the model."
                },
                "InternalData": {
                    "type": "object",
                    "description": "Dictionary of values that will help in debugging the model."
                },
                "Outputs": {
                    "type": "object",
                    "description": "Dictionary of values returned by the model."
                }
            },
            "required": [
                "Key",
                "PredictionQualifiedName",
                "EntityQualifiedName",
                "EntityMatch",
                "ModelVersion",
                "ModelParametersVersion",
                "DateTimeCreated",
                "Inputs",
                "InternalData",
                "Outputs"
            ]
        },
        "delorean_prediction_error" : {
            "type": "object",
            "properties": {
                "ErrorType": {
                    "type": "string",
                    "description": "The type of error.",
                    "enum": [
                        "INPUT_SCHEMA_ERROR",
                        "INPUT_VALIDATION_ERROR",
                        "NO_MODEL_AVAILABLE",
                        "INTERNAL_ERROR"
                    ]
                },
                "Metadata": {
                    "type": "object",
                    "description": "Key value pairs containing metadata about the delorean model and service."
                },
                "Messages": {
                    "type": "array",
                    "description": "Array of message objects.",
                    "items": { "$ref": "#/definitions/message"}
                }
            },
            "required": [
                "ErrorType",
                "Metadata",
                "Messages"
            ]
        },
        "message": {
            "type": "object",
            "properties": {
                "message": {
                    "type": "string",
                    "description": "The message string."
                },
                "type": {
                    "type": "string",
                    "description": "The type of message contained in the message field.",
                    "enum": [
                        "MESSAGE",
                        "SERVICE_ERROR",
                        "MODEL_ERROR"
                    ]
                }
            },
            "required": [
                "message",
                "type"
            ]
        }
    }
}